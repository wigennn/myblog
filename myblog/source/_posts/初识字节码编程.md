---
title: 初识字节码编程
date: 2020-07-17 14:22:45
tags: 字节码编程
---

### 一、前言
一个系统的监控从我之前了解到的都是在代码里做硬编码或者使用AOP的方式采集方法执行信息，出入参，异常，耗时去监控一个系统是否健康。但是这样的监控方式一旦大量使用，后期不好维护。

<!--more-->
后来了解到原来监控系统还能以更高级的方式实现。即使用javaagent与字节码操作结合实现。目前，字节码操作中目前有比较常见的三个框架，ASM,JAVASSIST,BYTE BUDDY, 这几个框架都能进行字节码操作，其中ASM更偏向与底层，需要了解字节码指令以及操作数栈等知识。

### 二、ASM

asm是一个java字节码操作框架。它能被用来动态生成类或者增强既有类的功能。asm直接产生二进制class文件，也可以在类被加载入java虚拟机之前动态改变类行为。java class被存储在严格格式定义的.class文件里，这些类拥有足够的元数据来解析类中的所有元素：类名称、方法、属性以及java字节码指令。asm从类文件读入信息后，能够改变类行为，分析类信息，甚至根据用户要求生成新类。

javaagent，首先对这个有点印象是因为IDEA破解的时候在配置文件加了javaagent:xxx.jar(哈哈哈)，然后一般如果做非侵入式的监控系统的话，通常是使用javaagent+asm的。

asm的用途
 - 类的代理 cglib
 - 混沌工程
 - 反向工程
 - 结合javaagent做非侵入式监控，方法耗时，日志，机器性能等现有类型产品springbootadmin
 - 软件破解
 
 
 先来看下写个helloworld的字节码是什么样的，可以idea安装插件asm直接查看
 ![asm_helloworld](/imgs/asm_helloworld.png)


 如果使用ASM呢？ASM的编码方式用到了访问者设计模式(不同角色看不同数据)。
 
### 三、总结
打开了新世界，字节码编程还是蛮有趣的，可使用ASM框架实现非侵入式的系统监控。