---
title: 分布式唯一ID-雪花算法
date: 2020-08-20 14:15:19
tags: 分布式
---
# 分布式id
### 为什么要使用分布式id？
在复杂分布式系统中，往往需要对大量的数据和消息进行唯一标识。如在美团点评的金融、支付、餐饮、酒店、猫眼电影等产品的系统中，数据日渐增长，对数据库的分库分表后需要有一个唯一ID来标识一条数据或消息，数据库的自增ID显然不能满足需求；特别一点的如订单、骑手、优惠券也都需要有唯一ID做标识。此时一个能够生成全局唯一ID的系统是非常必要的

<!--more-->

### 常见分布式id解决方案
- UUID
- redis自增id
- 雪花算法
- 美团leaf
- 数据库自增id

### 雪花算法
划分64位bit码 

0 00000000000000000000000000000000000000000 00000 00000 000000000000

- 第1位是符号位
- 第2~42是时间的二进制格式
- 第43~52是机器标识二进制格式
- 第53~64是序号二进制格式

### 让我们来算算
41位时间
    
为什么时间是41位？

    System.out.println(Long.toBinaryString(System.currentTimeMillis()).split("").length);
    输出结果是41

如果时间全打满,支持多久?
    
    我说的打满的意思是41位全为1
    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < 41; i++) {
        sb.append("1");
    }
    System.out.println((Long.parseLong(sb.toString(), 2) - System.currentTimeMillis()) / (1000*60*60*24*365));
    输出结果大约是还支持400+年
    
10位机器码

一般10位机器码会把它划分为，5位数据中心，5位机器标识

#### 雪花算法的实现
很简单，根据二进制移位("<<")并作或("|")运算 